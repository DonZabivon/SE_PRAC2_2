;
; Программа вычисления факториала.
; Вводит число с клавиатуры, вычисляет факториал,
; и выводит результат на экран.
; Допустимый ввод: числа в диапазоне [1 - 12],
; при больших числах результат не помещается в 32 бита.
;


; Рекурсивная функция вычисления факториала
; Аргумент передается в регистре R1.
; Результат возвращается в регистре R0.
FACT:    
    ; Условие выхода из рекурсии (R1 == 1)
    PUSHR R1
    PUSH 1
    JEQ RETURN

    ; Помещаем аргумент на стек (понадобится позже)
    PUSHR R1

    ; Вычесть 1 из R1
    PUSH 1
    PUSHR R1
    SUB
    POPR R1    

    ; Вызвать функцию рекурсивно для аргумента меньшего на единицу
    CALL FACT
    ; Умножить результат (R0) на аргумент (который сейчас на вершине стека)
    PUSHR R0    
    MUL
    POPR R1

RETURN:
    ; Выход из функции, помещаем результат в R0
    PUSHR R1
    POPR R0
    RET

; Точка входа в программу
    BEGIN

    ; Ввод числа
    IN

    ; Помещаем число в R1 (аргумент функции)
    POPR R1

    ; Вызов рекурсивной функции
    CALL FACT
    
    ; Помещаем результат на стек
    PUSHR R0
    
    ; Вывод числа
    OUT

    END